<template>
  <div :class="`review review${old ? '_old' : ''}`">
    <div class="review_info" @click.prevent="() => isOpen = !isOpen">
      <div class="review_info_data">
        <span class="review_info_time">
          От 24.12.2023
          <span v-if="!old" class="review_info_deadline">(осталось 2 рабочих дня)</span>
        </span>
        <BadgeUI v-for="i in badges" :key="i.text" class="badge" :text="i.text" :color="i.color" />
      </div>
      <InlineSvg svg="chevron-down" :class="`icon icon${isOpen ? '_active' : ''}`" />
    </div>

    <div v-if="isOpen" :class="`review_main ${isOpen ? '' : 'review_main_disabled'}`">
      <div class="review_main_before">
        <h3><span>Ранняя</span>версия</h3>
        <div class="review_main_changes">
          <label v-for="o in oldValues" :key="o.label" for="name" class="review_main_field">
            <span>{{ o.label }}</span>
            <textarea name="name"
              :value="o.value" />
          </label>
          <!-- <label for="name" class="review_main_field">
            <span>Предмет контракта</span>
            <textarea name="name"
              placeholder="Провод монтажный витой Мезонин 2х1,5 мм в декоративной оплетке для отрытой проводки" />
          </label>
          <label for="name" class="review_main_field">
            <span>Место заключения</span>
            <textarea name="name" placeholder="Очко динозавтра" />
          </label> -->
        </div>
      </div>
      <div class="review_main_after">
        <h3><span>Измененная</span>версия</h3>
        <div class="review_main_changes">
          <label v-for="o in newValues" :key="o.label" for="name" class="review_main_field">
            <span>{{ o.label }}</span>
            <textarea name="name"
              :value="o.value" />
          </label>
          <!-- <label for="name" class="review_main_field">
            <span>Предмет контракта</span>
            <textarea name="name"
              placeholder="Провод монтажный витой Мезонин 2х1,5 мм в декоративной оплетке для отрытой проводки" />
          </label>
          <label for="name" class="review_main_field">
            <span>Место заключения</span>
            <textarea name="name" placeholder="Очко динозавтра" />
          </label> -->
        </div>
      </div>
      <footer class="review_main_footer">
        <textarea class="comment"
          value="'Цена единицы дополнительно поставляемого Товара или цена единицы Товара при уменьшении предусмотренного Договором количества поставляемого Товара должна определяться как частное от деления первоначальной цены Договора на предусмотренное в Договоре количество Товара'" />
        <div class="buttons" v-if="!old">
          <ButtonUI blue-trans>Аргументировать отказ</ButtonUI>
          <ButtonUI blue-fill icon="check">Принять</ButtonUI>
        </div>
      </footer>
    </div>
  </div>
</template>

<script setup lang="ts">
import BadgeUI from './ui/BadgeUI.vue';
import ButtonUI from './ui/ButtonUI.vue';
import { Ref, ref } from 'vue';

interface Props {
  old?: boolean;
  badges: { text: string, color: string }[];
  change?: any;
}

const isOpen: Ref<boolean> = ref(false);
const { old, badges, change } = defineProps<Props>();

const oldValues: Ref<any[]> = ref([]);
const newValues: Ref<any[]> = ref([]);
console.log(change);

Object.keys(change ?? {}).forEach((k) => {
  if(change[k].old || change[k].new) {
    console.log(k, change[k]);
    oldValues.value.push({value: change[k].old, label: k})
    newValues.value.push({value: change[k].new, label: k})
  }
});
</script>

<style lang="sass" scoped>
@import '../assets/sass/colors'
.review_old
  background: #fff !important
  .badge
    background: $grey
  h3 span 
    color: $dark-blue !important 
  textarea, input
    pointer-events: none 

.review_main
  transition: transform 0.4s opacity 0.2s
  margin-top: 24px
  min-height: 50px
  min-width: 100%
  display: grid
  gap: 24px
  grid-template-areas: "before after" "footer footer"

  &_before
    grid-area: before
    display: flex
    flex-direction: column
    gap: 24px
    h3
      color: $dark-blue
      font-size: 18px
      font-weight: 600
      line-height: 24px
      letter-spacing: -0.36px
      span
        color: $blue
        margin-right: 4px
  &_after
    grid-area: after
    display: flex
    flex-direction: column
    gap: 24px
    h3
      color: $dark-blue
      font-size: 18px
      font-weight: 600
      line-height: 24px
      letter-spacing: -0.36px
      span
        color: $blue
        margin-right: 4px
  &_field
    display: flex
    flex-direction: column
    gap: 12px
  textarea
    border-radius: 10px
    resize: none
    overflow: auto
    height: 56px
    padding: 8px
    background: $silver
    border: none
    outline: none
    color: $grey
    font-size: 14px
    font-weight: 400
    line-height: 20px
  &_changes
    display: flex
    flex-direction: column
    gap: 16px
  &_footer
    grid-area: footer
    display: flex
    flex-direction: column
    gap: 26px
    textarea
      height: 78px
      resize: none 
      width: 100%
    .buttons
      display: flex
      justify-content: space-between
    
.icon
  justify-self: flex-end
  transition: all 500ms
.icon_active
  transform: rotate(90deg)
.review
  position: relative
  padding: 24px
  background: $white
  display: flex
  flex-direction: column
  justify-content: center
  border-radius: 10px
  &_info
    cursor: pointer
    width: 100%
    color: $dark-blue
    font-size: 18px
    font-weight: 600
    line-height: 24px
    letter-spacing: -0.36px
    display: flex
    justify-content: space-between
    align-items: center
    &_data
      display: flex
      gap: 16px
    &_time
      margin-right: 4px
    &_deadline
      color: $blue
</style>